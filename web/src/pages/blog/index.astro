---
import Base from '../../layouts/Base.astro'
import {sanityClient} from 'sanity:client'
import {postsQuery} from '../../utils/sanity'

const posts = await sanityClient.fetch(postsQuery)
---

<Base title="Blog - waglesworld">
  <h1>Blog</h1>
  {
    posts.length === 0 ? (
      <p class="empty">No posts yet. Check back soon.</p>
    ) : (
      <ul class="posts">
        {posts.map((post: any) => (
          <li>
            <a href={`/blog/${post.slug.current}`}>
              <span class="post-title">{post.title}</span>
              <div class="post-meta">
                {post.publishedAt &&
                  new Date(post.publishedAt).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                  })}
                {post.estimatedReadingTime && ` \u00b7 ${post.estimatedReadingTime} min read`}
                {post.tags && post.tags.length > 0 && (
                  <span class="tags">
                    {post.tags.map((tag: string) => (
                      <span class="tag">{tag}</span>
                    ))}
                  </span>
                )}
              </div>
            </a>
          </li>
        ))}
      </ul>
    )
  }
</Base>

<style>
  .empty {
    color: #666;
    margin-top: 1rem;
  }

  .posts {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-top: 1rem;
  }

  .posts a {
    display: block;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f0f0f0;
  }

  .post-title {
    font-weight: 500;
    font-size: 1.1rem;
  }

  .post-meta {
    color: #666;
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }

  .tags {
    margin-left: 0.5rem;
  }

  .tag {
    background: #f0f0f0;
    padding: 0.1rem 0.4rem;
    border-radius: 3px;
    font-size: 0.75rem;
    margin-left: 0.25rem;
  }
</style>
